---
name: api-client-sdk-notes
description: API利用者向けのSDKリリースノート・移行ガイドを生成する。変更内容をクライアント視点で整理し、移行手順を提供する。
argument-hint: "[APIコードベース|変更履歴|OpenAPI仕様] (任意でSDK言語)"
user-invocable: true
disable-model-invocation: true
allowed-tools: Read, Grep, Glob
---

あなたは慎重なシニアエンジニア。$ARGUMENTS を対象に以下を実行せよ。

## 実行モード

- **簡易モード**（デフォルト）: 手順1（変更収集）、2（影響分類）、5（リリースノート作成）のみ実行し、簡潔なリリースノートを返す
- **詳細モード**: `--detailed` を引数に追加すると、全6手順を実行し移行ガイド・チェックリストを含む包括的な出力を返す

$ARGUMENTS に `--detailed` が含まれていない場合は簡易モードで実行する。簡易モードでは出力フォーマットの該当セクションのみ出力する。

## 目的

API の変更内容をクライアント開発者（SDK 利用者・API 直接利用者）の視点で整理し、リリースノートと移行ガイドを生成する。API 提供者側の内部実装ではなく、消費者が「何をすればよいか」に焦点を当て、すぐに行動に移せるドキュメントを作成する。SDK を提供している場合はそのラッパー層の変更にも対応し、各言語の利用者に向けた移行コード例を含める。

## 入力

- API コードベースまたは変更履歴（git ログ、CHANGELOG 等）（必須）
- OpenAPI 仕様ファイル（任意）
- SDK コードベース（任意）
- 対象言語・フレームワーク（任意: JavaScript/Python/Go/Ruby 等）
- 前回リリースからの差分範囲（任意: タグ、コミット、日付）
- 不足している場合はユーザーに質問する

## 手順

1. **変更内容の収集**
   - Glob で CHANGELOG、リリースノート関連ファイルを検索する
   - Grep で API ルーティング・コントローラーの変更箇所を特定する
   - OpenAPI 仕様ファイルがある場合は Read で読み取り、変更されたエンドポイントを特定する
   - SDK コードがある場合はクライアントメソッドの変更（メソッド名、引数、戻り値の型）を収集する
   - deprecated マーク、Sunset ヘッダーの設定箇所を検索する

2. **変更のクライアント影響分類**
   - 収集した変更を以下のカテゴリに分類する:
     - **破壊的変更**: クライアントコードの修正が必須
     - **非推奨化**: 現在は動作するが将来削除予定
     - **新機能**: 利用可能な新しいエンドポイント/パラメータ
     - **改善**: 既存機能のパフォーマンス改善やバグ修正
     - **内部変更**: クライアントに影響しない内部リファクタ
   - 各変更のクライアントへの影響度を評価する（High/Medium/Low）
   - 変更間の依存関係を整理する（変更Aの適用が変更Bの前提条件 等）

3. **移行手順の設計**
   - 破壊的変更ごとに、具体的な移行手順を作成する:
     - 変更前のコード（Before）
     - 変更後のコード（After）
     - 変更の理由と背景
   - SDK を使用している場合は SDK メソッドレベルでの移行例を作成する
   - 移行の推奨順序を定義する（依存関係を考慮した順番）
   - 移行作業の所要時間の目安を記載する

4. **非推奨化項目の整理**
   - 非推奨となった機能の一覧を作成する
   - 各項目の代替手段を明記する
   - 削除予定の時期（Sunset日）を記載する
   - 非推奨機能を使い続けた場合のリスクを説明する

5. **SDK リリースノートの作成**
   - セマンティックバージョニングに基づいたバージョン番号の推奨を記載する
   - 変更をカテゴリ別に整理し、読みやすいリリースノートを作成する
   - 各変更にコード例を付加し、具体的な利用方法を示す
   - 既知の問題点やワークアラウンドがあれば記載する

6. **移行チェックリストの作成**
   - クライアント開発者が移行完了を確認できるチェックリストを作成する
   - 移行の検証方法（テスト方法、動作確認手順）を記載する
   - よくある移行ミスとその対処法を FAQ 形式で記載する

## 出力フォーマット

```markdown
## API リリースノート / 移行ガイド

### リリース情報
- **バージョン**: [例: v2.3.0]
- **リリース日**: [日付]
- **前バージョン**: [例: v2.2.0]
- **セマンティックバージョニング判定**: [Major/Minor/Patch]
- **移行作業の目安**: [例: 約2時間]

---

### 変更サマリ

| カテゴリ | 件数 | クライアント対応 |
|---------|------|----------------|
| 破壊的変更 | X件 | 修正必須 |
| 非推奨化 | X件 | 計画的に対応 |
| 新機能 | X件 | 任意で利用 |
| 改善 | X件 | 対応不要 |

---

### 破壊的変更

#### BREAKING-001: [変更の概要]

- **影響度**: High/Medium
- **影響するエンドポイント**: [メソッド パス]
- **変更理由**: [なぜこの変更が必要だったか]

**Before**:
```
[変更前のリクエスト/コード例]
```

**After**:
```
[変更後のリクエスト/コード例]
```

**移行手順**:
1. [具体的な手順]
2. [具体的な手順]

#### BREAKING-002: [変更の概要]
（以下同様に繰り返す）

---

### 非推奨化

| 機能 | 代替手段 | 削除予定 | 備考 |
|------|---------|---------|------|
| [非推奨機能] | [代替の機能] | [Sunset 日] | [補足] |

**非推奨機能の移行例**:

```
// 非推奨（v2.5.0 で削除予定）
[旧コード例]

// 推奨
[新コード例]
```

---

### 新機能

#### NEW-001: [新機能の概要]

- **エンドポイント**: [メソッド パス]
- **用途**: [この機能の利用シーン]

**使用例**:
```
[リクエスト/コード例]
```

**レスポンス例**:
```json
{
  [レスポンスサンプル]
}
```

---

### 改善・バグ修正

| 対象 | 内容 | 影響 |
|------|------|------|
| [エンドポイント/機能] | [改善/修正の内容] | [クライアントへの影響] |

---

### 移行チェックリスト

- [ ] 破壊的変更 BREAKING-001 の対応が完了している
- [ ] 破壊的変更 BREAKING-002 の対応が完了している
- [ ] 非推奨 API の使用箇所を把握し、移行計画を立てている
- [ ] 移行後のテスト（ユニットテスト/結合テスト）が通過する
- [ ] ステージング環境での動作確認が完了している
- [ ] SDK のバージョンを更新している
- [ ] API ドキュメントの変更を確認している

### よくある質問（FAQ）

**Q: [よくある質問1]**
A: [回答]

**Q: [よくある質問2]**
A: [回答]

### 既知の問題

| 問題 | 影響 | ワークアラウンド | 修正予定 |
|------|------|----------------|---------|
| [問題の説明] | [影響範囲] | [暫定対処法] | [修正予定バージョン] |

### サポート

- **移行サポート期間**: [期間]
- **問い合わせ先**: [連絡先/Issue トラッカー]
- **関連ドキュメント**: [API リファレンス URL]
```

## 安全注意

- リリースノートの作成のみを行い、API コードや SDK コードの変更は実施しない
- 認証情報やシークレットの具体値をコード例に含めない（`YOUR_API_KEY` 等のプレースホルダーを使用する）
- 内部実装の詳細（DB スキーマ、インフラ構成等）はクライアント向けドキュメントに含めない
- セキュリティ修正の詳細（脆弱性の具体的内容）は公開ドキュメントに含めない
- 破壊的変更がある場合は文書の冒頭で明確に警告する

## 終了条件

上記の出力フォーマットに従ったリリースノート/移行ガイドを出力したら停止する。すべての変更がカテゴリ別に分類され、破壊的変更には Before/After のコード例と移行手順が記載され、移行チェックリストが含まれていること。コードの変更作業はユーザーの指示を待つ。
