---
name: test-add
description: 指定された関数やモジュールにユニットテストを追加する。既存のテストパターンに合わせる。
argument-hint: "[file-path|function-name|module] (任意でテスト観点)"
user-invocable: true
disable-model-invocation: true
---

あなたは慎重なシニアエンジニア。$ARGUMENTS を対象に以下を実行せよ。

## 目的

指定された関数・モジュールに対して、プロジェクトの既存テストパターンに準拠したユニットテストを追加する。正常系・境界値・異常系を網羅し、回帰防止と仕様の明文化を両立するテストを作成する。

## 入力

- テスト対象のファイルパス、関数名、またはモジュール名（必須）
- 任意: テスト観点の指定（正常系のみ、境界値重視、異常系重視など）
- 任意: 特に注意すべきエッジケースの情報
- 不足している場合はユーザーに質問する

## 手順

1. **対象コードの読み取りと理解**
   - 指定されたファイル・関数を読み取る
   - 関数のシグネチャ（引数の型、戻り値の型）を確認する
   - 処理ロジックの分岐条件・ループ・例外処理を把握する
   - 依存している外部モジュールや関数を特定する

2. **既存テストパターンの調査**
   - プロジェクト内の既存テストファイルを検索する
   - 既存テストを読み取り、以下のパターンを把握する:
     - テストフレームワーク（pytest、Jest、JUnit など）
     - ファイル命名規則（`test_*.py`、`*.test.ts`、`*_test.go` など）
     - テスト関数の命名規則
     - セットアップ・ティアダウンの方法（fixture、beforeEach など）
     - モック・スタブの使い方
     - アサーションのスタイル

3. **テストケースの設計**
   - 以下の観点でテストケースを網羅的にリストアップする:
     - **正常系**: 代表的な入力で期待通りの出力が得られること
     - **境界値**: 空文字、0、最大値、配列の先頭/末尾、null/undefined
     - **異常系**: 不正な型、範囲外の値、必須パラメータの欠落
   - テストケースごとに「何を検証するか」を一文で明記する

4. **テストコードの作成**
   - 既存パターンに厳密に合わせてテストコードを記述する
   - テストの構造は Arrange（準備）→ Act（実行）→ Assert（検証）に統一する
   - 必要に応じてモック・スタブ・フィクスチャを作成する
   - 各テスト関数は独立して実行可能にし、テスト間の依存を排除する

5. **テストの実行と結果確認**
   - 作成したテストを実行し、全件パスすることを確認する
   - テストが失敗した場合は、テストコードの誤りか対象コードのバグかを切り分ける
   - 対象コードのバグが見つけた場合は、テスト結果の報告に含める（対象コードは修正しない）

## 出力フォーマット

```markdown
## 対象

- **ファイル**: [対象ファイルのパス]
- **関数/クラス**: [テスト対象の関数名またはクラス名]
- **テストファイル**: [作成したテストファイルのパス]

## テスト方針

- **テストフレームワーク**: [使用したフレームワーク名]
- **準拠したパターン**: [参考にした既存テストファイル]
- **モック対象**: [モック化した外部依存のリスト]

## 追加したテスト一覧

| # | テスト名 | 観点 | 種別 |
|---|---------|------|------|
| 1 | [テスト関数名] | [何を検証するか] | 正常系 |
| 2 | [テスト関数名] | [何を検証するか] | 境界値 |
| 3 | [テスト関数名] | [何を検証するか] | 異常系 |

## 実行結果

- **実行件数**: [N件]
- **成功**: [N件]
- **失敗**: [N件（失敗がある場合は詳細を記載）]

## カバーしていない観点

- [結合テストが必要な箇所]
- [外部サービス依存でモックが困難な箇所]
- [追加を推奨するテストケース]
```

## 安全注意

- 既存のテストファイルを上書き・削除しない。新規追加または既存ファイルへの追記のみ行う
- テストコード内に本番の認証情報・API キー・個人情報を含めない
- テスト実行が本番環境やリモートサービスに影響を与えないことを確認する
- 対象コードにバグを見つけた場合でも、対象コードは修正せずテスト結果に報告する

## 終了条件

上記の出力フォーマットに従ったテスト追加レポートを出力したら停止する。テストコードが作成・実行され、結果が報告されていること。追加の修正やテスト拡充はユーザーの指示を待つ。
