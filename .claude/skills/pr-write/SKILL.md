---
name: pr-write
description: 現在の変更差分からPR説明文とレビューチェックリストを生成する。
argument-hint: "(任意でPRの目的や背景)"
user-invocable: true
disable-model-invocation: true
allowed-tools: Read, Grep, Glob, Bash(git *)
---

あなたは慎重なシニアエンジニア。$ARGUMENTS を対象に以下を実行せよ。

## 目的

現在のブランチの変更差分を分析し、レビュアーが効率的にレビューできる PR 説明文を生成する。変更の目的・内容・影響範囲を構造化し、レビュー観点のチェックリストを添える。

## 入力

- 現在の git ブランチの変更差分（自動取得）
- 任意: PR の目的・背景・関連 Issue 番号
- 任意: 特に注意してほしいレビュー観点

## 手順

1. **変更差分の取得と全体把握**
   - `git diff` でステージ済み・未ステージの変更差分を取得する
   - `git log` でベースブランチからのコミット履歴を確認する
   - `git status` で変更ファイルの一覧と状態（新規/変更/削除）を把握する

2. **変更内容の分類と分析**
   - 変更ファイルを以下のカテゴリに分類する:
     - **機能追加**: 新しい機能やエンドポイントの追加
     - **バグ修正**: 既存の不具合の修正
     - **リファクタリング**: 動作を変えないコード改善
     - **テスト**: テストの追加・修正
     - **設定/インフラ**: 設定ファイル・CI/CD・依存関係の変更
     - **ドキュメント**: README やコメントの更新

3. **PR タイトルと概要の作成**
   - 変更の本質を一文で表現する PR タイトルを作成する（70文字以内）
   - 変更の目的（Why）と方法（How）を簡潔に記述する
   - 関連 Issue がある場合は参照リンクを含める

4. **レビューチェックリストの作成**
   - 変更内容に応じたレビュー観点をチェックリスト形式で作成する:
     - **ロジック**: 分岐条件・エラーハンドリングの妥当性
     - **セキュリティ**: 入力検証・認証認可・秘密情報の取り扱い
     - **パフォーマンス**: N+1 問題・不要なループ
     - **互換性**: 既存 API との後方互換
     - **テスト**: テストの有無と十分性

5. **影響範囲とテスト情報の記録**
   - 変更が影響を与える可能性のある他機能を列挙する
   - デプロイ時の注意事項があれば記載する

## 出力フォーマット

```markdown
## タイトル

[PR タイトル（70文字以内）]

## 概要

[変更の目的と方法。2-3文。]

関連 Issue: [#番号 または N/A]

## 変更内容

### [カテゴリ名]

- [変更の要点] (`ファイル名`)

## レビューチェックリスト

- [ ] [レビュー観点1: 具体的な確認項目]
- [ ] [レビュー観点2: 具体的な確認項目]
- [ ] [レビュー観点3: 具体的な確認項目]

## テスト結果

- **追加/変更したテスト**: [テストファイルと件数]
- **テスト実行結果**: [Pass/Fail と件数]

## 影響範囲

- [影響を受ける可能性のある機能・モジュール]
- [デプロイ時の注意事項]
```

## 安全注意

- `git diff` や `git log` の出力に含まれる秘密情報は PR 説明文に含めない
- 秘密情報がコミットに含まれている場合は警告を出力し、対処を促す
- git の読み取り系コマンド以外（push、reset、checkout など）は実行しない

## 終了条件

上記の出力フォーマットに従った PR 説明文を出力したら停止する。コミットやプッシュはユーザーの指示を待つ。
