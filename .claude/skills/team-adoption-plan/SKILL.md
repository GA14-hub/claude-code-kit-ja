---
name: team-adoption-plan
description: CI/CD・品質ツールのチーム導入計画を策定する。合意形成・役割分担・PR ワークフロー・例外規定・ロールアウト手順を含む。
argument-hint: "[project-dir|tool-name] (任意でチーム規模や導入対象)"
user-invocable: true
disable-model-invocation: true
allowed-tools: Read, Grep, Glob
---

あなたは慎重なシニアエンジニア。$ARGUMENTS を対象に以下を実行せよ。

## 実行モード

- **簡易モード**（デフォルト）: 手順2（合意形成プラン）、3（役割分担）、6（ロールアウト計画）のみ実行し、導入計画の骨子を返す
- **詳細モード**: `--detailed` を引数に追加すると、全6手順を実行しPRワークフロー・例外規定を含む包括的な導入計画を返す

$ARGUMENTS に `--detailed` が含まれていない場合は簡易モードで実行する。簡易モードでは出力フォーマットの該当セクションのみ出力する。

## 目的

新しい CI/CD パイプライン・品質ツール・開発プラクティスをチームに導入するための計画を策定する。技術的な設定だけでなく、チーム内の合意形成・役割分担・ワークフロー変更・例外規定・段階的ロールアウトを含む、組織的な導入計画を作成する。

## 入力

- プロジェクトディレクトリまたは導入対象のツール・プラクティス名（必須）
- 任意: チーム規模（人数）と構成（フロントエンド/バックエンド/フルスタック等）
- 任意: 現在の開発フロー・ツール構成
- 任意: 導入の動機（品質問題、スケーラビリティ、コンプライアンス等）
- 任意: 想定される抵抗や懸念事項
- 不足している場合はユーザーに質問する

## 手順

1. **現状の開発プラクティス分析**
   - プロジェクトの構成ファイルを Glob で検索し、現在のツール構成を把握する:
     - CI/CD 設定（`.github/workflows/`、`Jenkinsfile`、`.gitlab-ci.yml`）
     - リンター・フォーマッター設定
     - テスト設定とカバレッジ設定
     - Git フック設定（`.husky/`、`.pre-commit-config.yaml`）
   - Grep で `CONTRIBUTING.md`、開発ガイドライン、コーディング規約を検索する
   - 既存の PR テンプレートやレビュー基準を確認する
   - 現状の課題（ツール不足、ルール未整備、属人化）を整理する

2. **合意形成プランの作成**
   - 導入の目的と期待効果を明確に言語化する:
     - 解決する課題（バグの混入頻度、リリースの不安定さ、レビューの属人化等）
     - 期待される改善（CI による品質保証、自動化による工数削減等）
     - チームにとっての具体的なメリット
   - チーム内での合意形成のステップを設計する:
     - 課題共有の場の設定（振り返り会、技術共有会等）
     - 導入提案書の作成（Before/After の比較、他チームの事例）
     - トライアル期間の設定と評価基準の合意
     - フィードバック収集の仕組み

3. **役割分担の設計**
   - 導入に必要な役割を定義する:
     - **推進者（Champion）**: 導入の推進・技術的な問い合わせ対応
     - **設定担当**: CI/CD 設定・ツール設定の構築と保守
     - **ドキュメント担当**: ガイドライン・手順書の作成と更新
     - **レビュー担当**: 新しいルールに基づくレビューの先行実施
   - 各役割の責任範囲と期間（導入期 / 定着期 / 運用期）を定義する
   - 属人化を防ぐためのナレッジ共有の仕組みを提案する

4. **PR ワークフローの設計**
   - 新しい品質基準を組み込んだ PR ワークフローを設計する:
     - PR 作成時のチェックリスト（自動 + 手動）
     - CI による自動チェックの内容と合否基準
     - レビュアーのアサイン方法（CODEOWNERS、ローテーション等）
     - マージ条件（CI パス + レビュー承認 + チェックリスト完了）
   - ワークフローの可視化（フロー図の概要）を含める
   - ボトルネック（レビュー待ち時間等）への対策を提案する

5. **例外規定の策定**
   - 新しいルールの例外を認める条件とプロセスを定義する:
     - **緊急修正（Hotfix）**: CI を一部スキップしてよい条件と事後対応
     - **実験的変更**: カバレッジ閾値やリンタールールの一時的緩和
     - **レガシーコード**: 既存コードへの新ルール適用の猶予期間
     - **外部依存**: サードパーティの問題による CI 失敗時の対応
   - 例外申請のフロー（誰に、どの手段で、何を記録するか）を定義する
   - 例外の濫用を防ぐ仕組み（例外の定期棚卸し、期限付き例外）を設計する

6. **段階的ロールアウト計画**
   - 導入を以下のフェーズに分割する:
     - **Phase 0（準備）**: ツール選定、環境構築、ドキュメント作成
     - **Phase 1（トライアル）**: 一部メンバー・一部リポジトリで試行
     - **Phase 2（拡大）**: チーム全体への展開、フィードバック反映
     - **Phase 3（定着）**: 運用ルールの確定、例外規定の調整
     - **Phase 4（最適化）**: 運用データに基づく改善、自動化の拡充
   - 各フェーズの期間目安、完了条件、撤退基準を設定する
   - フェーズ間のゲート（次に進むための判断基準）を定義する

## 出力フォーマット

```markdown
## 現状分析

- **チーム構成**: [推定または入力されたチーム情報]
- **現在のツール構成**: [検出された CI/CD・品質ツール一覧]
- **現在の課題**: [整理された課題リスト]
- **導入対象**: [導入するツール・プラクティスの概要]

## 合意形成プラン

### 導入の目的と期待効果

| 課題 | 現状 | 導入後 |
|------|------|-------|
| [課題1] | [現状の状態] | [期待される改善] |
| [課題2] | [現状の状態] | [期待される改善] |

### 合意形成ステップ

1. [ステップ1: 課題共有]
2. [ステップ2: 提案と議論]
3. [ステップ3: トライアル合意]
4. [ステップ4: 結果評価と本導入判断]

## 役割分担

| 役割 | 責任 | 推奨人数 | 期間 |
|------|------|---------|------|
| 推進者 | [責任範囲] | [N名] | [導入期〜定着期] |
| 設定担当 | [責任範囲] | [N名] | [導入期] |
| ドキュメント担当 | [責任範囲] | [N名] | [全期間] |

## PR ワークフロー

### フロー概要

1. [ブランチ作成]
2. [コード変更 + ローカルチェック]
3. [PR 作成（テンプレート記入）]
4. [CI 自動チェック]
5. [レビュアーによる手動チェック]
6. [マージ]

### マージ条件

- [ ] CI の全ジョブがパス
- [ ] 指定レビュアーの承認（N名以上）
- [ ] PR チェックリストの必須項目が完了

## 例外規定

| 例外ケース | 条件 | 承認者 | 事後対応 |
|-----------|------|-------|---------|
| 緊急修正 | [条件] | [承認者] | [事後対応] |
| 実験的変更 | [条件] | [承認者] | [事後対応] |
| レガシーコード | [条件] | [承認者] | [事後対応] |

### 例外管理ルール

- [例外の記録方法]
- [定期棚卸しの頻度]
- [例外の期限と延長条件]

## ロールアウト計画

| フェーズ | 期間 | 内容 | 完了条件 | 撤退基準 |
|---------|------|------|---------|---------|
| Phase 0 | [期間] | 準備 | [条件] | - |
| Phase 1 | [期間] | トライアル | [条件] | [基準] |
| Phase 2 | [期間] | 拡大 | [条件] | [基準] |
| Phase 3 | [期間] | 定着 | [条件] | - |
| Phase 4 | [期間] | 最適化 | [条件] | - |

## 成功指標（KPI）

| 指標 | 現状値 | 目標値 | 測定方法 |
|------|-------|-------|---------|
| [指標1] | [現状] | [目標] | [方法] |
| [指標2] | [現状] | [目標] | [方法] |

## リスクと対策

| リスク | 可能性 | 影響 | 対策 |
|-------|-------|------|------|
| [リスク1] | 高/中/低 | 高/中/低 | [対策] |
```

## 安全注意

- プロジェクトの設定ファイルの変更は行わず、計画書の出力のみ行う
- チームの既存文化やプラクティスを否定する表現を使わない
- 導入計画は強制ではなく提案として記述し、チームの判断を尊重する
- 個人名やチーム内部の評価に関する情報を含めない
- セキュリティ関連の設定詳細（認証情報、アクセス権限の具体値）を出力に含めない

## 終了条件

上記の出力フォーマットに従ったチーム導入計画を出力したら停止する。現状分析、合意形成プラン、役割分担、PR ワークフロー、例外規定、ロールアウト計画、成功指標が含まれていること。計画の実行はチームの合意を得てから行う。
