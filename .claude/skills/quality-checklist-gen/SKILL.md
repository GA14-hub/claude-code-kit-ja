---
name: quality-checklist-gen
description: リポジトリの構成を分析し、PR 品質チェックリストを自動生成する。
argument-hint: "[project-dir] (任意で重点観点: security/performance/a11y)"
user-invocable: true
disable-model-invocation: true
allowed-tools: Read, Grep, Glob, Bash(git *)
---

あなたは慎重なシニアエンジニア。$ARGUMENTS を対象に以下を実行せよ。

## 目的

プロジェクトの言語・フレームワーク・ディレクトリ構成・既存ルールを分析し、そのリポジトリに特化した PR 品質チェックリストを生成する。汎用的なチェックリストではなく、プロジェクトの技術スタック・コーディング規約・テスト方針に基づいた実用的なチェックリストを作成する。

## 入力

- プロジェクトディレクトリ（必須）
- 任意: 重点的にカバーしたい観点（security / performance / a11y / testing 等）
- 任意: チーム規模やレビュー体制の情報
- 任意: 過去の PR で頻出した指摘事項
- 不足している場合はユーザーに質問する

## 手順

1. **プロジェクト構成の分析**
   - Glob でプロジェクトの構成ファイルを網羅的に検索する:
     - パッケージ管理（`package.json`、`pyproject.toml`、`go.mod`）
     - リンター設定（`.eslintrc*`、`ruff.toml`、`.golangci.yml`）
     - フォーマッター設定（`.prettierrc*`、`black`、`gofmt`）
     - テスト設定（`jest.config*`、`pytest.ini`、`vitest.config*`）
     - 型チェック設定（`tsconfig.json`、`mypy.ini`）
     - CI 設定（`.github/workflows/`）
   - 検出した設定ファイルを Read で読み取り、適用されているルールを把握する
   - ディレクトリ構成からアーキテクチャパターン（MVC、DDD、クリーンアーキテクチャ等）を推定する

2. **既存ルール・規約の収集**
   - Grep で以下のルールソースを検索する:
     - `CONTRIBUTING.md`、`DEVELOPMENT.md` 等のガイドライン文書
     - `.github/PULL_REQUEST_TEMPLATE.md`（既存の PR テンプレート）
     - `.editorconfig`
     - `CLAUDE.md` や `.claude/` 内のルールファイル
   - `git log` で直近の PR コミット（Merge commit）を確認し、PR の傾向を把握する
   - 既存のチェックリストや規約があれば内容を尊重する

3. **チェック項目の設計**
   - プロジェクトの特性に基づき、以下のカテゴリでチェック項目を設計する:
     - **コード品質**: リンターエラー、型チェック、命名規則、関数の複雑度
     - **テスト**: テストの追加・更新、カバレッジ、テスト命名
     - **セキュリティ**: 入力バリデーション、認証・認可、秘密情報
     - **パフォーマンス**: N+1 クエリ、不要な再レンダリング、メモリリーク
     - **ドキュメント**: API ドキュメント、コメント、CHANGELOG
     - **デプロイ**: マイグレーション、環境変数、後方互換性
   - 各項目はプロジェクト固有の表現にする（「テストを書く」ではなく「pytest で該当モジュールのテストを追加する」）

4. **重要度と適用条件の設定**
   - 各チェック項目に重要度を設定する:
     - **必須**: 全 PR で必ず確認する項目
     - **推奨**: 該当する場合に確認する項目
     - **任意**: 品質向上のために推奨する項目
   - 変更内容に応じた条件付きチェックを設計する:
     - 「DB スキーマ変更がある場合」→ マイグレーションチェック
     - 「API エンドポイント変更がある場合」→ API ドキュメント更新チェック
     - 「依存関係変更がある場合」→ ロックファイル更新チェック

5. **PR テンプレートの生成**
   - GitHub の PR テンプレート形式（`.github/PULL_REQUEST_TEMPLATE.md`）で出力する
   - チェックリストは Markdown のチェックボックス形式にする
   - セクション分けを明確にし、レビュアーが素早く確認できる構造にする
   - 自動チェック（CI）と手動チェック（レビュアー）を区別する

6. **CI 自動チェックとの連携提案**
   - チェック項目のうち CI で自動化できるものを特定する
   - 自動化されていない項目について、自動化の方法を提案する
   - 手動でしか確認できない項目を明確にし、レビュアーの負担を可視化する

## 出力フォーマット

```markdown
## プロジェクト分析結果

- **言語/フレームワーク**: [検出された技術スタック]
- **リンター**: [設定されているリンターとルール数]
- **テストフレームワーク**: [検出されたテストツール]
- **CI**: [設定されている CI ジョブの概要]
- **既存ルール文書**: [検出されたルール文書の一覧]
- **既存 PR テンプレート**: [あり（概要）/ なし]

## 生成したチェックリスト

### `.github/PULL_REQUEST_TEMPLATE.md`

[PR テンプレートの全文をコードブロックで出力]

## チェック項目の詳細

| # | カテゴリ | チェック項目 | 重要度 | 適用条件 | 自動化 |
|---|---------|------------|-------|---------|-------|
| 1 | コード品質 | [項目] | 必須 | 全 PR | CI |
| 2 | テスト | [項目] | 必須 | 全 PR | CI |
| 3 | セキュリティ | [項目] | 必須 | 該当時 | 手動 |

## 自動化の現状と提案

| チェック項目 | 現状 | 自動化方法 | 優先度 |
|-------------|------|-----------|-------|
| [項目] | 手動 | [ツール/設定] | 高/中/低 |
| [項目] | CI済 | - | - |

## 導入手順

1. [PR テンプレートの配置方法]
2. [チームへの周知方法]
3. [運用開始後の見直しサイクル]

## カスタマイズガイド

- **項目の追加**: [新しいチェック項目を追加する際の基準]
- **項目の削除**: [不要になった項目を削除する際の基準]
- **見直し頻度**: [チェックリストを見直す推奨頻度]
```

## 安全注意

- 既存の PR テンプレートがある場合は上書きせず、改善案として並記する
- ファイルの作成・変更は行わず、テンプレートの出力のみ行う
- プロジェクトのセキュリティ設定やシークレット情報を出力に含めない
- チーム固有の文化やワークフローを否定せず、既存の慣行を尊重した提案にする
- チェック項目が多すぎるとレビュー形骸化を招くため、15-25項目を目安とする

## 終了条件

上記の出力フォーマットに従った品質チェックリストを出力したら停止する。プロジェクト分析結果、PR テンプレート全文、チェック項目の詳細、自動化提案、導入手順が含まれていること。テンプレートファイルの配置はユーザーの指示を待つ。
