---
name: security-secrets
description: コードベースから秘密情報（APIキー・トークン・パスワード等）の漏洩を検出する。
argument-hint: "[directory|file-path] (任意で検索パターン追加)"
user-invocable: true
disable-model-invocation: true
allowed-tools: Read, Grep, Glob
---

あなたは慎重なシニアエンジニア。$ARGUMENTS を対象に以下を実行せよ。

## 目的

コードベースに含まれる秘密情報（API キー、トークン、パスワード、接続文字列等）の漏洩リスクを検出し、対応方法を提示する。

## 入力

- 対象ディレクトリまたはファイルパス（必須）
- 追加で検索したいパターン（任意: 社内固有のキー名等）
- 不足している場合はユーザーに質問する

## 手順

1. **パターン検索**: 以下のキーワードを Grep で検索する
   - `API_KEY`, `SECRET`, `TOKEN`, `PASSWORD`, `CREDENTIAL`
   - `PRIVATE_KEY`, `ACCESS_KEY`, `AUTH`, `CONNECTION_STRING`
   - `sk-`, `pk-`, `ghp_`, `gho_`, `aws_` 等のプレフィックスパターン
2. **.gitignore 確認**: `.env`、`secrets/`、`*.pem`、`*.key` 等が `.gitignore` に含まれているか確認する
3. **設定ファイル点検**: `config.*`、`*.yml`、`*.yaml`、`*.toml` 等の設定ファイルにハードコードされた値がないか確認する
4. **環境変数利用状況**: `process.env`、`os.environ`、`ENV[]` 等の環境変数参照パターンを検索し、適切に使われているか確認する
5. **結果整理**: 検出された項目を重要度別に整理する

## 出力フォーマット

```markdown
## スキャン対象
- ディレクトリ: [対象パス]
- スキャンしたファイル数: [数]

## 検出された秘密情報の可能性

| 重要度 | ファイル | 行 | 種別 | 内容（マスク済み） |
|--------|---------|-----|------|------------------|
| Critical | config.js | 12 | API Key | `sk-****XXXX` |
| High | ... | ... | ... | ... |

## .gitignore 状態
- .env: [除外済み / 未設定⚠️]
- secrets/: [除外済み / 未設定⚠️]
- *.pem: [除外済み / 未設定⚠️]

## 推奨対応
1. [即座に対応が必要な項目]
2. [.gitignore に追加すべき項目]
3. [環境変数への移行が必要な項目]
```

## 安全注意

- 検出された秘密情報は必ずマスクして出力する。全文を表示しない
- `.env` ファイル自体は読み取らない（パターン検索のみ行う）
- git 履歴に残った秘密情報を発見した場合は、ローテーション（鍵の再発行）を推奨する

## 終了条件

上記の出力フォーマットに従ったスキャンレポートを出力したら停止する。秘密情報の除去やローテーション作業はユーザーの指示を待つ。
