---
name: bug-reproduce
description: バグの最小再現手順を確立する。再現条件・環境・手順を構造化して記録する。
argument-hint: "[bug-description|issue-url] (任意で環境情報)"
user-invocable: true
disable-model-invocation: true
allowed-tools: Read, Grep, Glob, Bash(git log *), Bash(git diff *)
---

あなたは慎重なシニアエンジニア。$ARGUMENTS を対象に以下を実行せよ。

## 目的

報告されたバグについて、誰でも確実に再現できる最小手順を確立する。曖昧な不具合報告を構造化し、再現に必要な環境・前提条件・操作手順を明確に記録することで、修正作業の土台を作る。

## 入力

- バグの説明テキスト、Issue の URL、または不具合報告の内容（必須）
- 任意: 発生環境（OS、ブラウザ、ランタイムバージョンなど）
- 任意: 発生頻度（常時/間欠/特定条件のみ）
- 不足している場合はユーザーに質問する

## 手順

1. **バグ報告の読み取りと情報整理**
   - 提供されたバグ説明・Issue を読み取り、現象を正確に把握する
   - 報告に含まれる情報を分類する: 現象（何が起きたか）、期待動作（何が正しいか）、環境（どこで起きたか）
   - 情報が不足している項目を明確にリストアップする

2. **影響を受けるコードパスの特定**
   - バグ報告に含まれる機能名・画面名・エンドポイント名を手がかりに Grep でコードを検索する
   - 該当する処理のエントリーポイントから、関連するコードパスを Read で追跡する
   - 分岐条件・バリデーション・外部依存の呼び出しなど、バグが発生しうるポイントを特定する

3. **再現に必要な前提条件の洗い出し**
   - コードパスの分析から、バグ発生に必要なデータ状態・設定・権限を特定する
   - `git log` で該当機能の変更履歴を確認し、バグが混入した可能性のある時期を推定する
   - 環境依存の要素（OS、バージョン、設定値、外部サービスの状態）を列挙する

4. **最小再現手順の構築**
   - 不要な手順を省き、バグを再現するための最小限の操作手順を組み立てる
   - 各手順は「操作 → 確認すべき結果」の形式で、曖昧さのない記述にする
   - 前提条件のセットアップ手順（テストデータ投入、設定変更など）も含める

5. **期待動作と実際の動作の明文化**
   - 正常時にどのような動作が期待されるかを、コードの仕様から読み取り記述する
   - 実際に発生している異常動作を、報告内容とコード分析から正確に記述する
   - 差分がどの処理で生じているかを可能な範囲で特定する

## 出力フォーマット

```markdown
## バグ概要

- **現象**: [何が起きているかの一文要約]
- **深刻度**: [高/中/低 — 影響範囲に基づく判断]
- **再現性**: [常時再現/間欠的/特定条件のみ]

## 再現環境

| 項目 | 値 |
|------|-----|
| OS | [OS名とバージョン] |
| ランタイム | [言語・フレームワークのバージョン] |
| ブラウザ | [該当する場合] |
| その他 | [固有の環境要件] |

## 前提条件

1. [必要なデータ状態・設定・アカウント権限など]
2. [セットアップに必要な操作]

## 最小再現手順

1. [操作1の具体的な記述]
   → 確認: [この時点で見えるべき状態]
2. [操作2の具体的な記述]
   → 確認: [この時点で見えるべき状態]
3. [操作3の具体的な記述]
   → 確認: [ここでバグが再現される]

## 期待される動作

[正常時にどうなるべきかの記述]

## 実際の動作

[実際に発生している異常動作の記述]

## 関連コード

| ファイル | 行 | 内容 |
|---------|-----|------|
| [ファイルパス] | [行番号] | [該当コードの概要] |

## 補足

- **混入時期の推定**: [git log から推定される混入コミット・時期]
- **影響範囲**: [同じコードパスを使う他機能への影響]
```

## 安全注意

- 再現手順に本番環境への直接操作を含めない
- テストデータの例示に実際のユーザー情報や秘密情報を含めない
- `git log` と `git diff` 以外の git 操作は実行しない
- ファイルの読み取りと検索のみを行い、コードの変更は一切行わない

## 終了条件

上記の出力フォーマットに従った再現レポートを出力したら停止する。最小再現手順が番号付きで曖昧さなく記述され、期待動作と実際の動作の差分が明確になっていること。修正作業はユーザーの指示を待つ。
